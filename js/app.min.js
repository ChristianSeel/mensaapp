function onBackKeyDown(){jQT.goBack()}function onMenuKeyDown(){}function addMensaToFavorite(e){console.log("addMensaToFavorite "+e);db.transaction(function(t){t.executeSql("UPDATE Mensen SET isfavorite=1 WHERE mensaid="+e)},dbError,function(){});return!0}function removeMensaFromFavorite(e){console.log("removeMensaFromFavorite "+e);db.transaction(function(t){t.executeSql("UPDATE Mensen SET isfavorite=0 WHERE mensaid="+e)},dbError,function(){});return!0}function doLike(e,t){t==null&&(t=function(){});FB.api("/"+fbuser.id+"/og.likes","post",{access_token:fbaccessToken,object:e},function(e){DEBUG_MODE&&console.log(e);if(!e||e.error){t();if(e.error.code==3501){$(".ps-toolbar-like .ps-toolbar-content").addClass("active").delay(1e3).removeClass("active");return}navigator.notification.alert("Es trat ein Fehler bei Facebook auf.",alertDismissed,"Fehler","OK")}else{DEBUG_MODE&&console.log("Post ID: "+e.id);t();$(".ps-toolbar-like .ps-toolbar-content").addClass("active").delay(1e3).removeClass("active")}})}function fbLogin(){FB.login(function(e){},{scope:fbAppScope})}function fbLogout(){$("#busy").fadeIn();$("#konto .scrollpanel .online").fadeOut();$("#konto .refreshIcon").fadeOut();FB.logout(function(e){DEBUG_MODE&&console.log("[Facebook] Logout function");$("#konto .scrollpanel .offline").show(function(){refreshScroll($("#konto"));$("#busy").fadeOut()});$("#konto .scrollpanel .online").html("");$('[data-clearOnLogout="true"]').html("");$('[data-deleteOnLogout="true"]').remove("");$("#pointlog").data("loaded",!1);$("#couponlog").data("loaded",!1)})}function onLogin(){DEBUG_MODE&&console.log("function onLogin fired");DEBUG_MODE&&console.log("Hallo "+fbuser.full_name);$("#konto .scrollpanel .offline").hide();$("#konto .scrollpanel .online").html(getKontoTpl()).fadeIn();$("#konto .refreshIcon").fadeIn()}function getKontoTpl(){var e="e";fbuser.numberofcoupons==1&&(e="");var t='<div class="span nopadding">\n	<div id="kontooverview">\n		<img class="backgroundimage" src="'+fbuser.picture+'"/>\n		<div class="content">\n			<div class="line"></div>\n			<h2>Hi '+fbuser.first_name+'!</h2>\n			<a id="totalpoints" href="#pointlog"><span>'+fbuser.totalpoints+'</span> Punkte</a>\n			<a id="couponcount" href="#couponlog"><span>'+fbuser.numberofcoupons+"</span> Gutschein"+e+'</a>\n			<div class="userimg" style="background-image: url('+fbuser.picture+');"></div>\n		</div>\n	</div>\n</div>\n\n<a href="#couponlog" class="bold graybutton icon icon-coupon">Gutscheine</a>\n<a href="#pointlog" class="bold graybutton icon icon-pointlog">Punkte-Historie</a>\n<a id="playKontoVideo" href="#" class="bold graybutton icon icon-help">Hilfe-Video</a>\n<a href="#" id="fblogout" class="bold bluebutton icon">Abmelden</a>';return t}function doShare(e){if(!fbuser){navigator.notification.confirm("Damit du diese Funktion nutzen kannst, musst du dich in dein "+fbxKontoName+" einloggen.",function(e){e==1&&fbLogin()},"Login erforderlich","Einloggen,Abbrechen");return!1}$("#busy").fadeIn();fbxapi("user/share/?&authdata="+fbaccessToken+"&link="+e,function(t){$("#busy").fadeOut();DEBUG_MODE&&console.log(t);navigator.notification.alert("Der Link zum Event wurde erfolgreich auf deinem Facebook-Profil veröffentlicht.",alertDismissed,"Event wurde geteilt","OK");DEBUG_MODE||googleAnalytics.trackEvent("Events","Share",e)},function(e){DEBUG_MODE&&console.log(e);if(e.error.title)var t=e.error.title+"";else var t="Fehler";if(e.error.description)var n=e.error.description+"";else var n="Es ist ein unbekannter Fehler aufgetreten.";$("#busy").fadeOut();navigator.notification.alert(n,alertDismissed,t,"OK")})}function alertDismissed(){DEBUG_MODE&&console.log("alert dismissed")}function hideSplashscreen(){$("#splashscreen").fadeOut()}function api(e,t,n){if(networkState==0){response={error:{error_key:"networkState",title:"Fehler",description:"Du hast keine Verbindung zum Internet!"}};n(response);return!1}DEBUG_MODE&&console.log("api request: "+e);e.indexOf("?")==-1&&(e+="?");e+="&enviroment=mobile&platform="+device.platform+"&platformversion="+device.version+"&appversion="+appversion;$.getJSONP({url:api_url+e,cache:!1,timeout:4e4,success:function(e){e.error?n(e):t(e)}})}function getTimestamp(){return Math.round(+(new Date)/1e3)}function getDatestamp(e){typeof e=="undefined"?d=new Date:d=new Date(e);return d.getFullYear()+""+(pad(d.getMonth()+1,2)+"")+(pad(d.getDate(),2)+"")}function roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function pad(e,t){var n="000000000"+e;return n.substr(n.length-t)}function squareit(e){return e*e}function abc(e){this.element=e;this.element.addEventListener("touchstart",this,!1)}window.addEventListener("load",function(){new FastClick(document.getElementById("jqt"));new FastClick(document.getElementById("tabbar"))},!1);var app={initialize:function(){this.bind()},bind:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){DEBUG_MODE&&console.log("Cordova is ready.");document.addEventListener("resume",app.onDeviceResume,!1);document.addEventListener("backbutton",onBackKeyDown,!1);document.addEventListener("menubutton",onMenuKeyDown,!1);document.addEventListener("online",function(){networkState=1;DEBUG_MODE&&console.log("Network online.")},!1);document.addEventListener("offline",function(){networkState=0;DEBUG_MODE&&console.log("Network offline.")},!1);networkConnection=navigator.network.connection.type;if(networkConnection==Connection.UNKNOWN||networkConnection==Connection.NONE){networkState=0;DEBUG_MODE&&console.log("Network state: "+networkState)}else{networkState=1;DEBUG_MODE&&console.log("Network state: "+networkState)}uuid=DEBUG_MODE&&device.uuid;devicePlatform=device.platform.toLowerCase();if(devicePlatform=="iphone"||devicePlatform=="ipad"||devicePlatform=="iphone simulator"||devicePlatform=="ipad simulator"||devicePlatform=="ipod")devicePlatform="ios";$("body").addClass(devicePlatform);deviceVersion=device.version;deviceVersion.length>2&&(deviceVersion=deviceVersion.slice(0,2));deviceVersion=Math.floor(deviceVersion+0);$("body").addClass("platformv"+deviceVersion);if(!DEBUG_MODE)if(devicePlatform=="ios"){googleAnalytics=window.plugins.googleAnalyticsPlugin;googleAnalytics.startTrackerWithAccountID("UA-34897325-1")}else{googleAnalytics=window.plugins.analytics;googleAnalytics.start("UA-34897325-1",function(){console.log("Analytics: start success")},function(){console.log("Analytics: start failure")})}initDB()},onDeviceResume:function(){DEBUG_MODE&&console.log("App resumed");fullDomRefresh()}};$(function(){setTimeout(function(){$("#jqt").css("min-height","0px !important")},1e3);initiscroll();$("#tabbar ul li a").bind("click",function(e){e.preventDefault();jQT.goTo($(this).data("href"),"")});$("#jqt > div").live("pageAnimationStart",function(e,t){if(t.direction=="in"){$("#tabbar li a").removeClass("current");$('#tabbar a[data-href="#'+$(this).data("tabbaritem")+'"]').addClass("current");!DEBUG_MODE&&googleAnalytics.trackPageview("/"+$(this).attr("id"))}else disableNavigation=!0});$("#jqt > div").live("pageAnimationEnd",function(e,t){t.direction=="out"&&(disableNavigation=!1)});$("#fblogin").live(clickEvent,function(e){e.preventDefault();fbLogin()});$("#fblogout").live(clickEvent,function(e){e.preventDefault();fbLogout()});$(".mensa").live("click",function(e){e.preventDefault();var t=$(this).data("mensaid");console.log("go to speiseplan "+t);getMenu(t,getDatestamp(),!0);jQT.goTo("#speiseplan","slideleft");return!1});$(".mensa .addFavorite").live("click",function(e){e.preventDefault();var t=$(this).parent(".mensa[data-mensaid]").data("mensaid");if($(this).hasClass("isfavorite")===!0){removeMensaFromFavorite(t)===!0&&$(this).removeClass("isfavorite");console.log("mensa "+t+" removed from favorites")}else{addMensaToFavorite(t)===!0&&$(this).addClass("isfavorite");console.log("mensa "+t+" added to favorites")}return!1});$("#events .refreshIcon").live(clickEvent,function(e){e.preventDefault();if(!$(this).hasClass("rotate")){$("#busy").fadeIn();$(this).addClass("rotate");getEventsFromApi(function(){$("#events .refreshIcon").removeClass("rotate");$("#busy").fadeOut()})}})});$.getJSONP=function(e){function o(e,t,r,i){DEBUG_MODE&&console.log("[ERROR] api request failed ("+r+") at "+api_url+n);r=="timeout"?e.success({status:"error",error:{title:"Zeitüberschreitung",description:"Der Server antwortete nicht rechtzeitig. Mögliche Ursache ist eine schlechte Internetverbindung."}}):e.success({status:"error",error:{title:"Fehler",description:"Es konnte keine Verbindung zum Server aufgebaut werden. Bitte versuche es später noch einmal."}})}e.dataType="jsonp";$.ajax(e);var t=$(document.getElementsByTagName("head")[0].firstChild),n=t.attr("src")||"",r=(n.match(/callback=(\w+)/)||[])[1];if(!r)return;var i=0,s=window[r];t[0].onerror=function(n){t.remove();o(e,{},"error",n);clearTimeout(i)};if(!e.timeout)return;window[r]=function(e){clearTimeout(i);s(e);s=null};i=setTimeout(function(){t.remove();o(e,{},"timeout");s&&(window[r]=function(){})},e.timeout)};abc.prototype={handleEvent:function(e){switch(e.type){case"touchstart":this.onTouchStart(e);break;case"touchmove":this.onTouchMove(e);break;case"touchend":this.onTouchEnd(e)}},onTouchStart:function(e){e.preventDefault();this.element.className="hover";var t=e.target;t.nodeType==3&&(t=t.parentNode);t=t.innerText;document.getElementById(t)&&fscroll.scrollToElement("dt#"+t,1);this.element.addEventListener("touchmove",this,!1);this.element.addEventListener("touchend",this,!1);return!1},onTouchEnd:function(e){e.preventDefault();this.element.className="";this.element.removeEventListener("touchmove",this,!1);this.element.removeEventListener("touchend",this,!1);return!1},onTouchMove:function(e){e.preventDefault();var t=document.elementFromPoint(e.targetTouches[0].clientX,e.targetTouches[0].clientY);t.nodeType==3&&(t=t.parentNode);t=t.innerText;document.getElementById(t)&&fscroll.scrollToElement("dt#"+t,1);return!1}};